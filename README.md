# yab
Yet another blockchain

## Что такое Height, Epoch ViewNumber, Round?
### Round
Время жизни блокчейна разделено на раунды, раунд это минимальный промежуток времени по истечении которого можно говорить о гарантированном прогрессе. Каждый следующий раунд увеличивает ViewNumber на единицу. Высота создаваемого блока всегда равна номеру текущего раунда.
 
Во время раунда могут произойти следующие события:
#### Proposer
- P собрал 2*f + 1 голос и отправил остальным пирам новый блок со сформированным из голосов QC 
- P не смог собрать голоса за ∆ и отправил остальным пирам новый блок и самый старший QC известный ему
- P не смог собрать голоса и не смог отправить блок, раунд длится 2*∆ и P переходит к следующему раунда
- Р если это последний раунд в эпохе Р переходит к старту новой эпохи
#### Replica
- R ждет ∆ нового блока, когда получает его принимает решение голосовать или нет



Блокчейн растет за счет последовательного увеличения своей длинны в процессе proposing(аналогично майнингу) новых блоков. 

## Как изменить содержимое Blockchain
-  В Hello сообщении будет содержаться высота текущего блока у других пиров, мы пытаемся синхронизироваться до этой высоты и скачатьизвестные блоки. После синхрониизации высота блокчейна + 1 совпадает с текущим вью
- Когда мы в качестве репликии получаем валидный Proposal, валидным мы считаем Proposal полученный от текущего proposer
- Когда мы в качестве текущего proposer делаем Proposal
- Когда мы добавляем пустой блок и переходим к следующему вью по таймауту
- Когда мы синхронизируемся по StartEpoch и заполняем пропущенные блоки пустыми

Высота блокчейна никогда не отличается от текущего номера вью больше че на единицу . --- это верно???


## Когда могут возникнуть форки?
- Proposer послал нам блок отличный от блоков других участников, тогда

| Before | Vote | Adversary P | Vote | Proposer P |
| --- | --- | --- | --- | --- |
| B'(B) | B' | B''(B') | B'' | B'''(B'') |
| B'(B) | B' | A(B') | A | B'''(B'') | 

У второго пира будет форк B - B' - A B - B' - B'' - B''', даже если второй и последующий Proposer окажутся злоумышленниками, 
в худшем случае они смогут растить форки на блоке B' подобные А, очевидно, что они не соберут QC для своего блока и второй пир рано или поздно узнает новый QC
Более того, в этом случае у нас будет доказательство мошенничества в виде блока B'' из соответствующего QC и блока A из proposal

- Adversary может не послать блок и тогда он либо не достигнет прогресса и мы получим новый блок на этой высоте от нового Proposer,
в случае если он не собрал QC, что аналогично первому случаю для пииров который получили Proposal. 
Либо Proposer соберет нужное количество воутов и соберет QС, который мы получим в новом блоке, что аналогично проблеме в сети.
